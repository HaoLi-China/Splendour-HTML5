<!DOCTYPE html>
<html lang="en" id="paulrhayes-com" class="no-js">
	<head>
<title>单人模式</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="css/card.css" type="text/css"/>
		<script type="text/javascript" src="js/gameViewJs/data.js">
</script>
		<script type="text/javascript" src="js/checkViewJs/jquery.js">
</script>
		<script type="text/javascript" src="js/utilitiesJs/getCookie.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/updateDatabase.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/basis.js">
</script>
		<script type='text/javascript' src='js/publicJs/isOnline.js'>
</script>
		<script type="text/javascript" src="js/gameViewJs/utils.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/butterflyInit.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/butterflyManager.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/butterflyGroup.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/butterfly.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/power.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/test.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/num.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/player.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/linkDatabase.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/resourse.js">
</script>
		<script type="text/javascript" src="js/publicJs/toolJS.js">
</script>
		<script type="text/javascript" src="js/publicJs/button.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/buyTool.js">
</script>
		<script src="js/gameViewJs/photoviewJS1.js" type="text/javascript"
			charset="utf-8">
</script>
		<script type="text/javascript" src="js/publicJs/playSound.js">
</script>

		<style type="text/css" media="all">
body,div,canvas {
	image-rendering: optimizeSpeed;
	-webkit-image-rendering: optimizeSpeed;
	-webkit-interpolation-mode: nearest-neighbor;
}

body {
	padding: 0;
	margin: 0;
	font-size: 12px;
	background-color: #000;
}

body,html {
	height: 100%;
	overflow-x: hidden;
	overflow-y: hidden;
}

#outer {
	height: 100%;
	overflow: hidden;
	position: relative;
	width: 100%;
}

#outer[id] {
	display: table;
	position: static;
}

#middle {
	position: absolute;
	top: 50%;
}  /* for ie only*/
#middle[id] {
	display: table-cell;
	vertical-align: middle;
	position: static;
}

html {
	margin: 0;
	padding: 0;
}

body {
	margin: 0;
	padding: 0;
	background: black;
	color: #666;
	font-family: sans-serif;
}

.contain {
	padding-top: 20px;
	width: 600px;
}
</style>
		<script>
try {
	Typekit.load();
} catch (e) {
}
</script>
<script id="shader-vs" type="x-shader/x-vertex"> 
  attribute vec3 aPos;
  attribute vec2 aTexCoord;
  varying   vec2 pixel;
void main(void) {
   gl_Position = vec4(aPos, 1.);
   pixel = aTexCoord;
}
</script>

<script id="shader-fs-blur-horizontal" type="x-shader/x-fragment">
#ifdef GL_ES
precision highp float;
#endif
// original shader from http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/
// horizontal blur fragment shader
uniform sampler2D src_tex;
varying vec2 pixel;
uniform vec2 pixelSize;
void main(void) // fragment
{
	float h = pixelSize.x;
	vec4 sum = vec4(0.0);
	sum += texture2D(src_tex, vec2(pixel.x - 4.0*h, pixel.y) ) * 0.05;
	sum += texture2D(src_tex, vec2(pixel.x - 3.0*h, pixel.y) ) * 0.09;
	sum += texture2D(src_tex, vec2(pixel.x - 2.0*h, pixel.y) ) * 0.12;
	sum += texture2D(src_tex, vec2(pixel.x - 1.0*h, pixel.y) ) * 0.15;
	sum += texture2D(src_tex, vec2(pixel.x + 0.0*h, pixel.y) ) * 0.16;
	sum += texture2D(src_tex, vec2(pixel.x + 1.0*h, pixel.y) ) * 0.15;
	sum += texture2D(src_tex, vec2(pixel.x + 2.0*h, pixel.y) ) * 0.12;
	sum += texture2D(src_tex, vec2(pixel.x + 3.0*h, pixel.y) ) * 0.09;
	sum += texture2D(src_tex, vec2(pixel.x + 4.0*h, pixel.y) ) * 0.05;
    gl_FragColor.xyz = sum.xyz/0.98; // normalize
	gl_FragColor.a = 1.;
} 
</script>

<script id="shader-fs-blur-vertical" type="x-shader/x-fragment">
#ifdef GL_ES
precision highp float;
#endif
// original shader from http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/
// vertical blur fragment shader
uniform sampler2D src_tex;
varying vec2 pixel;
uniform vec2 pixelSize;
void main(void) // fragment
{
	float v = pixelSize.y;
	vec4 sum = vec4(0.0);
	sum += texture2D(src_tex, vec2(pixel.x, - 4.0*v + pixel.y) ) * 0.05;
	sum += texture2D(src_tex, vec2(pixel.x, - 3.0*v + pixel.y) ) * 0.09;
	sum += texture2D(src_tex, vec2(pixel.x, - 2.0*v + pixel.y) ) * 0.12;
	sum += texture2D(src_tex, vec2(pixel.x, - 1.0*v + pixel.y) ) * 0.15;
	sum += texture2D(src_tex, vec2(pixel.x, + 0.0*v + pixel.y) ) * 0.16;
	sum += texture2D(src_tex, vec2(pixel.x, + 1.0*v + pixel.y) ) * 0.15;
	sum += texture2D(src_tex, vec2(pixel.x, + 2.0*v + pixel.y) ) * 0.12;
	sum += texture2D(src_tex, vec2(pixel.x, + 3.0*v + pixel.y) ) * 0.09;
	sum += texture2D(src_tex, vec2(pixel.x, + 4.0*v + pixel.y) ) * 0.05;
    gl_FragColor.xyz = sum.xyz/0.98;
	gl_FragColor.a = 1.;
}
</script>

<script id="shader-fs-advance" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif

	uniform sampler2D sampler_prev;
	uniform sampler2D sampler_prev_n;
	uniform sampler2D sampler_blur;
	uniform sampler2D sampler_noise;
	uniform sampler2D sampler_noise_n;

	varying vec2 pixel;
	uniform vec2 pixelSize;
	uniform vec4 rnd;
	uniform vec2 mouse;
	uniform float time;
	uniform float fps;

void main(void) {
	// grabbing the blurred gradients
	vec2 d = pixelSize*4.;
	vec4 dx = (texture2D(sampler_blur, pixel + vec2(1,0)*d) - texture2D(sampler_blur, pixel - vec2(1,0)*d))*0.5;
	vec4 dy = (texture2D(sampler_blur, pixel + vec2(0,1)*d) - texture2D(sampler_blur, pixel - vec2(0,1)*d))*0.5;
	
	vec2 zoom_in = pixel + vec2(dx.x,dy.x)*pixelSize*8.; // adding the traveling wave front
	vec2 rand_noise = texture2D(sampler_noise, zoom_in + vec2(rnd.x, rnd.y)).xy;
	gl_FragColor.x = texture2D(sampler_prev, zoom_in).x + (rand_noise.x-0.5)*0.0025 - 0.002; // decay with error diffusion
	gl_FragColor.x -= (texture2D(sampler_blur, zoom_in + (rand_noise-0.5)*pixelSize).x -
					  texture2D(sampler_prev, zoom_in + (rand_noise-0.5)*pixelSize)).x*0.047; // reaction-diffusion

	gl_FragColor.a = 1.;
}
</script>

<script id="shader-fs-composite" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif

	uniform sampler2D sampler_prev;
	uniform sampler2D sampler_prev_n;
	uniform sampler2D sampler_blur;
	uniform sampler2D sampler_noise;
	uniform sampler2D sampler_noise_n;

	varying vec2 pixel;
	uniform vec2 pixelSize;
	uniform vec2 aspect;
	uniform vec4 rnd;
	uniform vec2 mouse;
	uniform float time;

void main(void) {

	vec2 lightSize=vec2(4.);

	// grabbing the blurred gradients
	vec2 d = pixelSize*2.;
	vec4 dx = (texture2D(sampler_blur, pixel + vec2(1,0)*d) - texture2D(sampler_blur, pixel - vec2(1,0)*d))*0.5;
	vec4 dy = (texture2D(sampler_blur, pixel + vec2(0,1)*d) - texture2D(sampler_blur, pixel - vec2(0,1)*d))*0.5;

	// adding the pixel gradients
	d = pixelSize*1.;
	dx += texture2D(sampler_prev, pixel + vec2(1,0)*d) - texture2D(sampler_prev, pixel - vec2(1,0)*d);
	dy += texture2D(sampler_prev, pixel + vec2(0,1)*d) - texture2D(sampler_prev, pixel - vec2(0,1)*d);

	vec2 displacement = vec2(dx.x,dy.x)*lightSize; // using only the red gradient as displacement vector
	float light = pow(max(1.-distance(0.5+(pixel-0.5)*aspect*lightSize + displacement,0.5+(mouse-0.5)*aspect*lightSize),0.),4.);
//	vec4 rd = 0.85-(1.-texture2D(sampler_prev,pixel-vec2(dx.x,dy.x)*pixelSize*2.5).x) + light*0.18;
	//rd = mix(rd, 1., light*(1.-texture2D(sampler_blur,pixel-vec2(dx.x,dy.x)*pixelSize*4.)).x); 

	// recoloring the lit up red channel
	vec4 rd = vec4(texture2D(sampler_prev,pixel+vec2(dx.x,dy.x)*pixelSize*8.).x)*vec4(0.7,1.5,2.0,1.0)-vec4(0.3,1.0,1.0,1.0);
	gl_FragColor = mix(rd,vec4(8.0,6.,2.,1.), light*0.75*vec4(1.-texture2D(sampler_prev,pixel+vec2(dx.x,dy.x)*pixelSize*8.).x)); 
	
	//gl_FragColor = texture2D(sampler_prev, pixel); // bypass
	gl_FragColor.a = 1.;
}
</script>

<script type="text/javascript">
	function getShader(gl, id) {
		var shaderScript = document.getElementById(id);
		var str = "";
		var k = shaderScript.firstChild;
		while (k) {
			if (k.nodeType == 3)
				str += k.textContent;
			k = k.nextSibling;
		}
		var shader;
		if (shaderScript.type == "x-shader/x-fragment")
			shader = gl.createShader(gl.FRAGMENT_SHADER);
		else if (shaderScript.type == "x-shader/x-vertex")
			shader = gl.createShader(gl.VERTEX_SHADER);
		else
			return null;
		gl.shaderSource(shader, str);
		gl.compileShader(shader);
		if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) == 0)
			alert(gl.getShaderInfoLog(shader));
		return shader;
	}

	requestAnimFrame = (function() {
		return window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function(callback, element) {
			setTimeout(callback, 1000 / 60);
		};
	})();

	var gl;
	var prog_advance;
	var prog_composite;
	var prog_blur_horizontal;
	var prog_blur_vertical;
	var FBO_main;
	var FBO_main2;
	var FBO_helper;
	var FBO_blur;
	var FBO_noise;
	var texture_main_l; // main, linear
	var texture_main_n; // main, nearest (accurate pixel access on the same buffer)
	var texture_main2_l; // main double buffer, linear
	var texture_main2_n; // main double buffer, nearest (accurate pixel access on the same buffer)
	var texture_helper; // to be used when a buffer for multi-pass shader programs is needed (2-pass Gaussian blur)
	var texture_blur; // blur result
	var texture_noise_n; // noise pixel accurate
	var texture_noise_l; // noise interpolated pixel access

	var halted = false;
	var delay = 3;
	var it = 1;
	var frames = 0;
	var fps = 60; // no hurdle for DX10 graphics cards
	var time;
	var mouseX = 0.5;
	var mouseY = 0.5;
	var animation;
	var timer;
	// texture size (must be powers of two, remember 2048x1024 flat could also be a 128x128x128 voxel)
	var sizeX = 1024;
	var sizeY = 1024; // 2048x1024 flat or 128x128x128 cube
	// viewport size
	var viewX = 1366;
	var viewY = 768;

	function loadload() {
		clearInterval(timer);
		var c = document.getElementById("colorful");
		try {
			gl = c.getContext("experimental-webgl", { depth : false });
		} catch (e) {
		}
		if (!gl) {
			alert("Your browser does not support WebGL");
			return;
		}
		c.width = viewX;
		c.height = viewY;

		prog_advance = gl.createProgram();
		gl.attachShader(prog_advance, getShader(gl, "shader-vs"));
		gl.attachShader(prog_advance, getShader(gl, "shader-fs-advance"));
		gl.linkProgram(prog_advance);

		prog_composite = gl.createProgram();
		gl.attachShader(prog_composite, getShader(gl, "shader-vs"));
		gl.attachShader(prog_composite, getShader(gl, "shader-fs-composite"));
		gl.linkProgram(prog_composite);

		prog_blur_horizontal = gl.createProgram();
		gl.attachShader(prog_blur_horizontal, getShader(gl, "shader-vs"));
		gl.attachShader(prog_blur_horizontal, getShader(gl, "shader-fs-blur-horizontal"));
		gl.linkProgram(prog_blur_horizontal);

		prog_blur_vertical = gl.createProgram();
		gl.attachShader(prog_blur_vertical, getShader(gl, "shader-vs"));
		gl.attachShader(prog_blur_vertical, getShader(gl, "shader-fs-blur-vertical"));
		gl.linkProgram(prog_blur_vertical);

		var posBuffer = gl.createBuffer();
		gl.bindBuffer(gl.ARRAY_BUFFER, posBuffer);

		var vertices = new Float32Array([ -1, -1, 0, 1, -1, 0, -1, 1, 0, 1, 1, 0 ]);

		var aPosLoc = gl.getAttribLocation(prog_advance, "aPos");
		gl.enableVertexAttribArray(aPosLoc);

		var aTexLoc = gl.getAttribLocation(prog_advance, "aTexCoord");
		gl.enableVertexAttribArray(aTexLoc);

		var texCoords = new Float32Array([ 0, 0, 1, 0, 0, 1, 1, 1 ]);

		var texCoordOffset = vertices.byteLength;

		gl.bufferData(gl.ARRAY_BUFFER, texCoordOffset + texCoords.byteLength, gl.STATIC_DRAW);
		gl.bufferSubData(gl.ARRAY_BUFFER, 0, vertices);
		gl.bufferSubData(gl.ARRAY_BUFFER, texCoordOffset, texCoords);
		gl.vertexAttribPointer(aPosLoc, 3, gl.FLOAT, gl.FALSE, 0, 0);
		gl.vertexAttribPointer(aTexLoc, 2, gl.FLOAT, gl.FALSE, 0, texCoordOffset);

		var noisepixels = [];
		var pixels = [];
		for ( var i = 0; i < sizeX; i++) {
			for ( var j = 0; j < sizeY; j++) {
				noisepixels.push(Math.random() * 255, Math.random() * 255, Math.random() * 255, 255);
				pixels.push(0, 0, 0, 255);
			}
		}
		/*
		 * if (Math.random() > density) pixels.push(0, 0, 0, 0); else pixels.push(255, 0, 0, 0);
		 */

		var rawData = new Uint8Array(noisepixels);
		texture_main_l = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, texture_main_l);
		gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, sizeX, sizeY, 0, gl.RGBA, gl.UNSIGNED_BYTE, rawData);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);

		texture_main_n = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, texture_main_n);
		gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, sizeX, sizeY, 0, gl.RGBA, gl.UNSIGNED_BYTE, rawData);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);

		rawData = new Uint8Array(noisepixels);
		rawData = new Uint8Array(noisepixels);
		texture_main2_l = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, texture_main2_l);
		gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, sizeX, sizeY, 0, gl.RGBA, gl.UNSIGNED_BYTE, rawData);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);

		texture_main2_n = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, texture_main2_n);
		gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, sizeX, sizeY, 0, gl.RGBA, gl.UNSIGNED_BYTE, rawData);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);

		rawData = new Uint8Array(pixels);
		texture_helper = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, texture_helper);
		gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, sizeX, sizeY, 0, gl.RGBA, gl.UNSIGNED_BYTE, rawData);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);

		rawData = new Uint8Array(pixels);
		texture_blur = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, texture_blur);
		gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, sizeX, sizeY, 0, gl.RGBA, gl.UNSIGNED_BYTE, rawData);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);

		rawData = new Uint8Array(noisepixels);
		texture_noise_l = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, texture_noise_l);
		gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, sizeX, sizeY, 0, gl.RGBA, gl.UNSIGNED_BYTE, rawData);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);

		texture_noise_n = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, texture_noise_n);
		gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, sizeX, sizeY, 0, gl.RGBA, gl.UNSIGNED_BYTE, rawData);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);

		// gl.uniform1i(gl.getUniformLocation(prog, "uTexSamp"), 0);
		FBO_main = gl.createFramebuffer();
		gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_main);
		gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture_main_l, 0);

		FBO_main2 = gl.createFramebuffer();
		gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_main2);
		gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture_main2_l, 0);

		FBO_helper = gl.createFramebuffer();
		gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_helper);
		gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture_helper, 0);

		FBO_blur = gl.createFramebuffer();
		gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_blur);
		gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture_blur, 0);

		FBO_noise = gl.createFramebuffer();
		gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_noise);
		gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture_noise_l, 0);

		gl.useProgram(prog_advance);
		setUniforms(prog_advance);

		gl.useProgram(prog_blur_horizontal);
		gl.uniform2f(gl.getUniformLocation(prog_blur_horizontal, "pixelSize"), 1. / sizeX, 1. / sizeY);
		gl.uniform1i(gl.getUniformLocation(prog_blur_horizontal, "src_tex"), 0);

		gl.useProgram(prog_blur_vertical);
		gl.uniform2f(gl.getUniformLocation(prog_blur_vertical, "pixelSize"), 1. / sizeX, 1. / sizeY);
		gl.uniform1i(gl.getUniformLocation(prog_blur_vertical, "src_tex"), 0);

		gl.useProgram(prog_composite);
		setUniforms(prog_composite);

		gl.activeTexture(gl.TEXTURE2);
		gl.bindTexture(gl.TEXTURE_2D, texture_blur);

		gl.activeTexture(gl.TEXTURE3);
		gl.bindTexture(gl.TEXTURE_2D, texture_noise_l);

		gl.activeTexture(gl.TEXTURE4);
		gl.bindTexture(gl.TEXTURE_2D, texture_noise_n);

		calculateBlurTexture();

		timer = setInterval(fr, 500);
		time = new Date().getTime();
		animation = "animate";
		anim();
	}
	function setUniforms(program) {
		gl.uniform2f(gl.getUniformLocation(program, "pixelSize"), 1. / sizeX, 1. / sizeY);
		gl.uniform4f(gl.getUniformLocation(program, "rnd"), Math.random(), Math.random(), Math.random(), Math.random());
		gl.uniform1f(gl.getUniformLocation(program, "fps"), fps);
		gl.uniform1f(gl.getUniformLocation(program, "time"), time);
		gl.uniform2f(gl.getUniformLocation(program, "aspect"), Math.max(1, viewX / viewY), Math.max(1, viewY / viewX));
		gl.uniform2f(gl.getUniformLocation(program, "mouse"), mouseX, mouseY);
		gl.uniform1i(gl.getUniformLocation(program, "sampler_prev"), 0);
		gl.uniform1i(gl.getUniformLocation(program, "sampler_prev_n"), 1);
		gl.uniform1i(gl.getUniformLocation(program, "sampler_blur"), 2);
		gl.uniform1i(gl.getUniformLocation(program, "sampler_noise"), 3);
		gl.uniform1i(gl.getUniformLocation(program, "sampler_noise_n"), 4);
	}
	function calculateBlurTexture() {
		// horizontal
		gl.viewport(0, 0, sizeX, sizeY);
		gl.useProgram(prog_blur_horizontal);
		gl.activeTexture(gl.TEXTURE0);
		if (it < 0) {
			gl.bindTexture(gl.TEXTURE_2D, texture_main2_l);
			gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_helper);
		} else {
			gl.bindTexture(gl.TEXTURE_2D, texture_main_l);
			gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_helper);
		}
		gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
		gl.flush();

		// vertical
		gl.viewport(0, 0, sizeX, sizeY);
		gl.useProgram(prog_blur_vertical);
		gl.activeTexture(gl.TEXTURE0);
		gl.bindTexture(gl.TEXTURE_2D, texture_helper);
		gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_blur);
		gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
		gl.flush();

		gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
		gl.flush();
	}

	function advance() {
		gl.viewport(0, 0, sizeX, sizeY);
		gl.useProgram(prog_advance);
		setUniforms(prog_advance);
		if (it > 0) {
			gl.activeTexture(gl.TEXTURE0);
			gl.bindTexture(gl.TEXTURE_2D, texture_main_l); // interpolated input
			gl.activeTexture(gl.TEXTURE1);
			gl.bindTexture(gl.TEXTURE_2D, texture_main_n); // "nearest" input
			gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_main2); // write to buffer
		} else {
			gl.activeTexture(gl.TEXTURE0);
			gl.bindTexture(gl.TEXTURE_2D, texture_main2_l); // interpolated
			gl.activeTexture(gl.TEXTURE1);
			gl.bindTexture(gl.TEXTURE_2D, texture_main2_n); // "nearest"
			gl.bindFramebuffer(gl.FRAMEBUFFER, FBO_main); // write to buffer
		}
		gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
		gl.flush();

		calculateBlurTexture();
		it = -it;
	}

	function composite() {
		gl.viewport(0, 0, viewX, viewY);
		gl.useProgram(prog_composite);
		setUniforms(prog_composite);
		if (it < 0) {
			gl.activeTexture(gl.TEXTURE0);
			gl.bindTexture(gl.TEXTURE_2D, texture_main_l);
			gl.activeTexture(gl.TEXTURE1);
			gl.bindTexture(gl.TEXTURE_2D, texture_main_n);
		} else {
			gl.activeTexture(gl.TEXTURE0);
			gl.bindTexture(gl.TEXTURE_2D, texture_main2_l);
			gl.activeTexture(gl.TEXTURE1);
			gl.bindTexture(gl.TEXTURE_2D, texture_main2_n);
		}
		gl.bindFramebuffer(gl.FRAMEBUFFER, null);
		gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
		gl.flush();
		frames++;
	}

	function anim() {
		if (!halted)
			advance();
		composite();
		switch (animation) {
		case "animate":
			setTimeout("requestAnimFrame(anim)", delay);
			break;
		case "reset":
			load();
			break;
		}
	}
	function setDelay(v) {
		delay = parseInt(v);
	}
	function fr() {
		var ti = new Date().getTime();
		frames = 0;
		time = ti;
	}
</script>
<style type="text/css">
#c {
	position: absolute;
	top: 0;
	left: 0;
	z-index: -1;
}
</style>

<style type="text/css">
	.circle {
		background-color: rgba(0,0,0,0);
		border:10px solid rgba(0,183,229,0.9);
		opacity:.9;
		border-right:5px solid rgba(0,0,0,0);
		border-left:5px solid rgba(0,0,0,0);
		border-radius:90px;
		box-shadow: 0 0 45px #2187e7;
		width:150px;
		height:150px;
		margin:0 auto;
		-moz-animation:spinPulse 1s infinite ease-in-out;
		-webkit-animation:spinPulse 1s infinite linear;
	}
	.circle1 {
		background-color: rgba(0,0,0,0);
		border:10px solid rgba(0,183,229,0.9);
		opacity:.9;
		border-left:5px solid rgba(0,0,0,0);
		border-right:5px solid rgba(0,0,0,0);
		border-radius:100px;
		box-shadow: 0 0 20px #2187e7; 
		width:100px;
		height:100px;
		margin:0 auto;
		position:relative;
		top:-145px;
		-moz-animation:spinoffPulse 1s infinite linear;
		-webkit-animation:spinoffPulse 1s infinite linear;
	}

	@-moz-keyframes spinPulse {
		0% { -moz-transform:rotate(160deg); opacity:0; box-shadow:0 0 1px #2187e7;}
		50% { -moz-transform:rotate(145deg); opacity:1; }
		100% { -moz-transform:rotate(-320deg); opacity:0; }
	}
	@-moz-keyframes spinoffPulse {
		0% { -moz-transform:rotate(0deg); }
		100% { -moz-transform:rotate(360deg);  }
	}
	@-webkit-keyframes spinPulse {
		0% { -webkit-transform:rotate(160deg); opacity:0; box-shadow:0 0 1px #2187e7; }
		50% { -webkit-transform:rotate(145deg); opacity:1;}
		100% { -webkit-transform:rotate(-320deg); opacity:0; }
	}
	@-webkit-keyframes spinoffPulse {
		0% { -webkit-transform:rotate(0deg); }
		100% { -webkit-transform:rotate(360deg); }
	}
</style>
<script src="js/gameViewJs/min.js" type="text/javascript"></script>
<script>		
$(document).ready(function() {
	$('.circle, .circle1').removeClass('stop');	    
		$('.triggerFull').click(function() {
				$('.circle, .circle1').toggleClass('stop');
		});
});
</script>
	</head>
	<body class="experiment"
		background="images/gameViewImage/gamebackground.gif"">
		<div style="position:absolute; top:0px; left:30px; width:20px; height:20px;">
		<!--  <Button text="A" onClick="fadeOutFaceOne();" />
		<Button text="B" onClick="fadeInFaceOne();" />-->
		</div>
		<style type="text/css"> 
body,html { 
	background-image: url(images/gameViewImage/gamebackground.gif); 
	height: 100%; 
	overflow-x: hidden; 
	overflow-y: hidden; 
} 
 
#mycanvas { 
	background: 0 no-repeat; 
	top: 0px; 
	position: absolute; 
	z-index: 9999; 
	width: 1024px; 
	height: 768px; 
} 
 
#experiment { 
	-webkit-perspective: 800; 
	-webkit-perspective-origin: 50% 200px; 
	-moz-perspective: 800; 
	-moz-perspective-origin: 50% 200px; 
} 
 
#board { 
	position: relative; 
	margin: 0px auto 0; 
	height: window.screen.height; 
	width: 1024px; 
	-webkit-transition: -webkit-transform 2s linear; 
	-webkit-transform-style: preserve-3d; 
	-moz-transition: -moz-transform 2s linear; 
	-moz-transform-style: preserve-3d; 
} 
 
#boardB { 
	position: absolute; 
	z-index: 9999; 
	margin: 20px auto 0; 
	top: 0px; 
	left: 60px; 
	height: 900px; 
	width: 900px; 
	-webkit-transition: -webkit-transform 2s linear; 
	-webkit-transform-style: preserve-3d; 
} 
 
.faceA { 
	position: absolute; 
	height: 705px; 
	width: 1024px; 
	padding: 0px; 
	background-color: #000; 
	font-size: 27px; 
	line-height: 1em; 
	color: #fff; 
	border: 1px solid #555; 
	border-radius: 3px; 
} 
 
.faceB { 
	position: absolute; 
	height: 900px; 
	width: 900px; 
	padding: 0px; 
	background-color: #0; 
	border-radius: 3px; 
} 
#board .one { 
	-webkit-transform: translateZ(0); 
	-moz-transform: translateZ(0); 
} 
#boardB .three { 
	-webkit-transform: translateZ(0); 
	-moz-transform: translateZ(0); 
} 
</style>

<audio src="music/backMusic.ogg" autoplay="autoplay" loop="loop">
</audio>

		<div id="experiment">
			<div id="board">
				<div class="faceA one" id="faceOne">
					<div id="outer">
						<div id="middle">
							<canvas id="mycanvas"></canvas>
							<div id="container"
								style="position: relative; width: 980px; height: 545px; top: -50%; margin: 0 auto;">
								<video id="monitor" width="1024px" autoplay></video>
								<canvas id="photo"></canvas>
							</div>
							<div id="msg"></div>
							<img src="images/gameViewImage/experiencebar.png"
								style="position: absolute; top: 0px; left: 654px;" />
							<div id="probar"
								style="position: absolute; top: 43px; left: 674px; color: red">
								<img src="images/gameViewImage/experiencetool.png"
									style="position: absolute; top: 0px; left: 0px;" />
								<!--<img src="images/gameViewImage/experiencetool.png" style="position:absolute; top:43px; left:852px;" /> -->
							</div>
							<div id="levelbar"
								style="position: absolute; top: 65px; left: 896px; color: white">

							</div>
							<img src="images/gameViewImage/toolbutton1.gif" name="shop"
								style="position: absolute; top: 590px; left: 163px;"
								onmouseOver=mouseoverShop(); onmouseout=mouseoutShop();
								onclick=fadeInshop(10); />
							<div id="boardB" style="display: none;">
								<div id="FaceThree"class="faceB three">
									<img src="images/gameViewImage/shoptool1.png" />
									<img src="images/gameViewImage/x.png"
										style="position: absolute; top: 230px; left: 750px;"
										onClick="fadeOutshop(10);" />
									<img name="shopbar" src="images/gameViewImage/shopbar1.gif"
										style="position: absolute; top: 32px; left: 142px;"
										onmouseOver=mouseOvershopbar(); onmouseOut=mouseOutshopbar();>
									<img name="price1" src="images/gameViewImage/price1-1.png"
										style="position: absolute; top: 358px; left: 208px;"
										onmouseOver=mouseOverP1(); onmouseOut=mouseOutP1(); />
									<img name="price2" src="images/gameViewImage/price2-1.png"
										style="position: absolute; top: 358px; left: 383px;"
										onmouseOver=mouseOverP2(); onmouseOut=mouseOutP2(); />
									<img name="price3" src="images/gameViewImage/price3-1.png"
										style="position: absolute; top: 358px; left: 557px;"
										onmouseOver=mouseOverP3(); onmouseOut=mouseOutP3(); />
									<img name="price4" src="images/gameViewImage/price4-1.png"
										style="position: absolute; top: 515px; left: 208px;"
										onmouseOver=mouseOverP4(); onmouseOut=mouseOutP4(); />
									<img name="price5" src="images/gameViewImage/price5-1.png"
										style="position: absolute; top: 515px; left: 383px;"
										onmouseOver=mouseOverP5(); onmouseOut=mouseOutP5(); />
									<img name="price6" src="images/gameViewImage/price6-1.png"
										style="position: absolute; top: 515px; left: 557px;"
										onmouseOver=mouseOverP6(); onmouseOut=mouseOutP6(); />
								</div>

								<div id="FaceFour" class="faceB three" style="display:none;">
									<img src="images/gameViewImage/shoptool2t.png" />
									<img src="images/gameViewImage/x.png"
										style="position: absolute; top: 230px; left: 73px;"
										onClick=fadeOutshop(10); />
									<img name="shopbarB" src="images/gameViewImage/shopbar1.gif"
										style="position: absolute; top: 31px; left: 86px;"
										onmouseOver=mouseOvershopbarB();
										onmouseOut=mouseOutshopbarB();>
									<img name="luretoolbuy"
										src="images/gameViewImage/luretoolbuy1.gif"
										style="position: absolute; top: 257px; left: 280px;"
										onmouseOver=mouseOverLT(); onmouseOut=mouseOutLT();
										onclick="buyLure();" />
									<img name="butterflygodtoolbuy"
										src="images/gameViewImage/butterflygodtoolbuy1.gif"
										style="position: absolute; top: 327px; left: 167px;"
										onmouseOver=mouseOverBG(); onmouseOut=mouseOutBG();
										onclick="buyButterflygod();" />
									<img name="nettoolbuy"
										src="images/gameViewImage/nettoolbuy1.gif"
										style="position: absolute; top: 300px; left: 420px;"
										onmouseOver=mouseOverN(); onmouseOut=mouseOutN();
										onclick="buyNet();" />
									<img name="removebeetoolbuy"
										src="images/gameViewImage/removebeetoolbuy1.gif"
										style="position: absolute; top: 405px; left: 313px;"
										onmouseOver=mouseOverRB(); onmouseOut=mouseOutRB();
										onclick="buyRemovebee();" />
									<img name="clocktoolbuy"
										src="images/gameViewImage/clocktoolbuy1.gif"
										style="position: absolute; top: 414px; left: 494px;"
										onmouseOver=mouseOverC(); onmouseOut=mouseOutC();
										onclick="buyClock();" />
								</div>
							</div>

							<img src="images/gameViewImage/toolbutton1.gif" name="removebee"
								style="position: absolute; top: 582px; left: 253px;"
								onmouseOver=mouseoverRemovebee();
								onmouseout=mouseoutRemovebee(); onclick=popoutremovebee(); />
							<div id="tool1_num"
								style="position: absolute; top: 622px; left: 293px; color: red"></div>
							<div id="lighting"
								style="position: absolute; top: 0px; left: 0px; display: none;">
								<img src="images/gameViewImage/lightingtool.png" />
							</div>
							<img src="images/gameViewImage/toolbutton1.gif"
								name="butterflygod"
								style="position: absolute; top: 580px; left: 355px;"
								onmouseOver=mouseoverButterflygod();
								onmouseout=mouseoutButterflygod(); onclick=popoutbutterflygod(); />
							<div id="tool2_num"
								style="position: absolute; top: 622px; left: 383px; color: red"></div>
							<div id="butterflygodtool"
								style="position: absolute; top: 0px; left: 100px; display: none;">
								<img src="images/gameViewImage/butterflygodtool.png" />
							</div>
							<img src="images/gameViewImage/toolbutton1.gif" name="net"
								style="position: absolute; top: 588px; left: 587px;"
								onmouseOver=mouseoverNet(); onmouseout=mouseoutNet();
								onclick=popoutnet(); />
							<div id="tool3_num"
								style="position: absolute; top: 622px; left: 627px; color: red"></div>
							<div id="nettool1"
								style="position: absolute; top: 0px; left: 100px; display: none;">
								<img src="images/gameViewImage/nettool1.png" />
							</div>
							<div id="nettool2"
								style="position: absolute; top: 0px; left: 100px; display: none;">
								<img src="images/gameViewImage/nettool2.png" />
							</div>
							<div id="nettool3"
								style="position: absolute; top: 0px; left: 100px; display: none;">
								<img src="images/gameViewImage/nettool3.png" />
							</div>
							<img src="images/gameViewImage/toolbutton1.gif" name="clock"
								style="position: absolute; top: 575px; left: 677px;"
								onmouseOver=mouseoverClock(); onmouseout=mouseoutClock();
								onclick=popoutclock(); />
							<div id="tool4_num"
								style="position: absolute; top: 622px; left: 717px; color: red"></div>
							<div id="clocktool1"
								style="position: absolute; top: 0px; left: 150px; display: none;">
								<img src="images/gameViewImage/clocktool1.png" />
							</div>
							<div id="clocktool2"
								style="position: absolute; top: 0px; left: 150px; display: none;">
								<img src="images/gameViewImage/clocktool2.png" />
							</div>
							<img src="images/gameViewImage/toolbutton1.gif" name="lure"
								style="position: absolute; top: 580px; left: 767px;"
								onmouseOver=mouseoverLure(); onmouseout=mouseoutLure();
								onclick=popoutlure(); />
							<div id="tool5_num"
								style="position: absolute; top: 622px; left: 807px; color: red"></div>
							<div id="luretool1"
								style="position: absolute; top: 0px; left: 80px; display: none;">
								<img src="images/gameViewImage/luretool1.png" />
							</div>
							<div id="luretool2"
								style="position: absolute; top: 0px; left: 80px; display: none;">
								<img src="images/gameViewImage/luretool2.png" />
							</div>
							<div id="luretool3"
								style="position: absolute; top: 0px; left: 80px; display: none;">
								<img src="images/gameViewImage/luretool3.png" />
							</div>
							<div id="luretool4"
								style="position: absolute; top: 0px; left: 80px; display: none;">
								<img src="images/gameViewImage/luretool4.png" />
							</div>
						</div>
					</div>
				</div>
				<div class="faceA one" id="faceTwo"
					style="background: url(images/gameViewImage/sampleB.gif); display:none; ">
					<div id="main">
						<div class="container">
							<div class="span-24 last"></div>
							<div class="span-24 last">
								<div id="filename">
									<p>
										</br>
										&nbsp;No selected
									</p>
								</div>
								<img src="images/gameViewImage/showall1.png" name="showall"
									style="position: absolute; top: 254px; left: 0px;"
									onmouseOver="mouseOvershowall();"
									onmouseOut="mouseOutshowall(); " onClick="allshow();" />
								<img src="images/gameViewImage/aboutBF1.png"
									name="aboutbutterfly"
									style="position: absolute; top: 280px; left: 0px;"
									onmouseOver="mouseOveraboutBF();"
									onmouseOut="mouseOutaboutBF();" onClick="aboutbf();" />
								<img src="images/gameViewImage/aboutB.png" id="aboutB"
									style="position: absolute; top: 0px; left: 0px; z-index: 999997; display: none;">
								<img src="images/gameViewImage/aboutbb1.png" id="aboutbb"
									name="aboutbbb"
									style="position: absolute; top: 600px; left: 357px; z-index: 999998; display: none;"
									onmouseOver="mouseOveraboutbb();"
									onmouseOut="mouseOutaboutbb();" onClick="cancelaboutbb();" />
								<div id="wrapper">
									<ul id="index_cards">
										<li id="card-1" style="display: none;">
											<h3>
												纹白蝶
											</h3>
											<img src="images/gameViewImage/butterfly11.gif" height="130"
												width="130" />
											<p>
												所属类别：鳞翅目 粉蝶科
												<br />
												虫体大小：翅展42--54mm
												<br />
												分布区域：世界广布种
												<br />
												简要介绍：翅面和脉纹白色。前翅顶角中部有2个黑色斑纹，后翅前缘有1黑斑。翅基部和前翅前缘色暗，雌蝶又明显深于雄蝶。
											</p>
										</li>
										<li id="card-2" style="display: none;">
											<h3>
												枯叶蝶
											</h3>
											<img src="images/gameViewImage/butterfly22.gif" height="130"
												width="130" />
											<p>
												所属类别：昆虫纲 蛱蝶科
												<br />
												展翅 78 - 100 mm
												<br />
												习性：多停在树干或有落叶的地面，不见访花。飞翔高而迅速。
												<br />
												简要介绍：雌雄外观近似但雄蝶翅腹面颜色较深，雌蝶翅色较淡，翅端较雄蝶尖锐外弯。
											</p>
										</li>
										<li id="card-3" style="display: none;">
											<h3>
												金线蝶
											</h3>
											<img src="images/gameViewImage/butterfly33.gif" height="130"
												width="130" />
											<p>
												所属类别：昆虫纲 凤蝶科
												<br />
												翅展：80-100mm
												<br />
												分布区域：南美洲
												<br />
												简要介绍：翅面纹络呈金色，翅基部和前翅前缘色暗，雌蝶又明显深于雄蝶。
											</p>
										</li>
										<li id="card-4" style="display: none;">
											<h3>
												光明女神蝶
											</h3>
											<img src="images/gameViewImage/butterfly44.gif" height="130"
												width="130" />
											<p>
												所属类别：昆虫纲 闪蝶科
												<br />
												地位：世界最知名蝴蝶之一
												<br />
												形态特征：美丽而梦幻般的蝴蝶，整个翅面犹如蔚蓝的大海上涌起朵朵白色的浪花，其颜色及花纹非常壮观，被誉为世界上最美丽的蝴蝶。
											</p>
										</li>
										<li id="card-5" style="display: none;">
											<h3>
												红点粉蝶
											</h3>
											<img src="images/gameViewImage/butterfly55.gif" height="130"
												width="130" />
											<p>
												所属类别：粉蝶科 鳞翅目
												<br />
												翅展：55～65mm。
												<br />
												生态习性：成虫出现于春、夏二季，生活在低、中海拔山区。喜访花。
												<br />
												形态特征：翅膀单纯黄色；各翅中央有1个褐色斑点。
											</p>
										</li>
										<li id="card-6" style="display: none;">
											<h3>
												黑脉金斑蝶
											</h3>
											<img src="images/gameViewImage/butterfly66.gif" height="130"
												width="130" />
											<p>
												翅展：8.9-10.2厘米
												<br />
												形态特征：翅膀上面呈黄褐橙色，翅脉及边缘黑色，边缘有两串细白点。前翅近端位有一些橙点。翅膀下面很相似，但前翅及后翅端呈黄褐色，而白点较大。
											</p>
										</li>
										<li id="card-7" style="display: none;">
											<h3>
												蓝凤蝶
											</h3>
											<img src="images/gameViewImage/butterfly77.gif" height="130"
												width="130" />
											<p>
												所属类别：鳞翅目 凤蝶科
												<br />
												分布：华西、华南、海南、贵州。
												<br />
												形态特征：翅黑色，有靛蓝色天鹅绒光泽。雄蝶后翅正面前缘有黄白色斑纹，臀角有外围红环的黑斑；后翅反面外缘有几个弧形红斑，臀角具3个红斑。
											</p>
										</li>
										<li id="card-8" style="display: none;">
											<h3>
												鸟翼蝶
											</h3>
											<img src="images/gameViewImage/butterfly88.gif" height="130"
												width="130" />
											<p>
												分布：从马六甲到巴布亚新几内亚、所罗门群岛和澳大利亚北部。
												<br />
												昆虫特点：雄蝶背面有黑和绿色的鲜明图案；前翅的腹面呈黑色，中央为绿松石色，覆以黑色脉纹。
											</p>
										</li>
										<li id="card-9" style="display: none;">
											<h3>
												鬼美人蝶
											</h3>
											<img src="images/gameViewImage/butterfly99.gif" height="130"
												width="130" />
											<p>
												传说中的卡申夫鬼美人凤蝶，一只价值25万美元，但捕捉者全部离奇死亡，惨不忍睹。卡申夫在云南一个神秘的山谷中发现了一种极其诡异的蝴蝶——左右两边翅膀图案不一样，左边是美女，右边是骷髅，合在一起就是‘鬼美人’！
											</p>
											</p>
										</li>
										<li id="card-0" style="display: none;">
											<h3>
												粉蝶
											</h3>
											<img src="images/gameViewImage/butterfly00.gif" height="130"
												width="130" />
											<p>
												分布全球
												<br />
												体态较小
											</p>
										</li>
									</ul>
								</div>
								<img src="images/gameViewImage/sellback1.png" name="sellback"
									style="position: absolute; top: 285px; left: 834px;"
									onmouseOver="mouseOversellback();"
									onmouseOut="mouseOutsellback();" onClick="fadeInFaceOne();" />
								<div id="fileimg"></div>
							</div>
							<div class="span-24 last">
								<canvas id="canvas_port" width="900" height="200"
									style="position:absolute; top:450px; left:62px;"></canvas>
								<script>
var j;
j = 0;
var _nb__img;
var _int__img = 150;
_nb__img = 0;

var loaded = 0;
var async_img_load = 0;
var _mover = 510;
var _default_movement = 440;
var _mouse_on = 0;

var resources = [ "images/gameViewImage/butterfly00.gif", "images/gameViewImage/butterfly11.gif",
		"images/gameViewImage/butterfly22.gif", "images/gameViewImage/butterfly33.gif",
		"images/gameViewImage/butterfly44.gif", "images/gameViewImage/butterfly55.gif",
		"images/gameViewImage/butterfly66.gif", "images/gameViewImage/butterfly77.gif",
		"images/gameViewImage/butterfly88.gif", "images/gameViewImage/butterfly99.gif" ];
		
var img_src = [];

jQuery.each(resources, function(index, value) {
	img_src[_nb__img] = {
		img : new Image(),
		x : Math.random() * 400 - 200,
		destx : 30 + Math.random() * 70 + 40,
		y : 100 + _int__img * _nb__img + Math.random() * 100,
		yoffset : 100 + Math.random() * 100,
		desty : _int__img * _nb__img,
		rot : 600 - Math.random() * 1200,
		destrot : 600 - Math.random() * 1200,
		scale : 1,
		name : value
	}
	img_src[_nb__img].img.src = value;
	async_img_load++;

	img_src[_nb__img].img.onload = function() {
		async_img_load--;
	}

	_nb__img++;
});

function drawDiap(ctx, img, selected) {
	ctx.translate(-85, -40);
	var white_border = 5;
	var shadow_border = 6;
	var shadow_border_light = 8;

	if (img.width == 0) {
		return;
	}

	var dest_height = 170;
	var dest_width = dest_height * img.width / img.height;

	if (dest_width > dest_height) {
		dest_width = dest_height;
		dest_height = dest_width * img.height / img.width;
	}

	ctx.fillStyle = 'rgba(30,30,30,0.1)';
	ctx.fillRect(0 - shadow_border_light, 0 - shadow_border_light, dest_width
			+ shadow_border_light * 2, dest_height + shadow_border_light * 2);

	if (selected) {
		ctx.fillStyle = 'rgba(30,200,30,0.5)';
		var shadow_border = 8;
		ctx.fillRect(0 - shadow_border, 0 - shadow_border, dest_width
				+ shadow_border * 2, dest_height + shadow_border * 2);
	} else {
		ctx.fillStyle = 'rgba(30,30,30,0.2)';
		ctx.fillRect(0 - shadow_border, 0 - shadow_border, dest_width
				+ shadow_border * 2, dest_height + shadow_border * 2);
	}

	ctx.fillStyle = 'rgb(255,255,255)';
	ctx.fillRect(0 - white_border, 0 - white_border, dest_width + white_border
			* 2, dest_height + white_border * 2);

	if (img.width != 0) {
		ctx.drawImage(img, 0, 0, dest_width, dest_height);
	}
}

function drawBg(ctx) {
	var img = new Image();
	img.src = "images/gameViewImage/sampleflowB.png"
	ctx.drawImage(img, 0, 0);
}

function drawCanvas(ctx) {
	j++;
	ctx.clearRect(0, 0, 950, 400);
	var i = j % 255;
	ctx.save();
	drawBg(ctx);
	jQuery.each(img_src, function(index, imag) {
		ctx.save();
		var off = _mover - 425;
		imag.y = imag.y - off * 48 / 950;
		if (imag.y < -200) {
			imag.y = _nb__img * _int__img - 1;
			imag.rot = 600 - Math.random() * 1200;
			imag.destrot = 600 - Math.random() * 1200;
			imag.x = Math.random() * 400 - 200;
			imag.yoffset = 600;
		}
		if (imag.y > _nb__img * _int__img) {
			imag.y = -200;
			imag.rot = 600 - Math.random() * 1200;
			imag.destrot = 600 - Math.random() * 1200;
			imag.x = Math.random() * 400 - 200;
			imag.yoffset = -600;
		}

		if (imag.y < 1000) {

			ctx.translate(imag.y + imag.yoffset, imag.x);
			ctx.rotate(imag.rot / 10000 * Math.PI * 2);
			ctx.scale(imag.scale, imag.scale);
			var selected = 0;
			if (imag.y > _mover - 60 && imag.y < _mover + 60 && _mouse_on) {
				selected = 1;
				imag.scale = (imag.scale * 10 + 1.2) / 11
				_selected = imag.name

			} else {
				imag.scale = (imag.scale * 10 + 1) / 11
			}

			drawDiap(ctx, imag.img, selected);

			if (imag.y < 900) {

				imag.x = (imag.x * 25 + imag.destx) / 26;

				imag.rot = (imag.rot * 25 + imag.destrot) / 26;
				imag.yoffset = imag.yoffset * 25 / 26;
			}
		}
		ctx.restore();
	});

	ctx.restore();
	if (!_mouse_on) {
		_mover = (_mover * 10 + _default_movement) / 11
	}

}

function aboutbf(){
	if(btfselt==-1){
		$('#filename').html("<p></br>&nbsp;请选择一个蝴蝶标本！</p>");
	}
    if(btfselt==1){
        fadeInABF1(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else if(btfselt==2){
        fadeInABF2(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else if(btfselt==3){
        fadeInABF3(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else if(btfselt==4){
        fadeInABF4(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else if(btfselt==5){
        fadeInABF5(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else if(btfselt==6){
        fadeInABF6(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else if(btfselt==7){
        fadeInABF7(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else if(btfselt==8){
        fadeInABF8(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else if(btfselt==9){
        fadeInABF9(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else if(btfselt==0){
        fadeInABF0(10);
        fadeInaboutB(10);
        fadeInaboutbb(10);
    }else{
    }
//    if(_selected == "images/gameViewImage/butterfly11.png"){
//        fadeInABF1(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else if(_selected == "images/gameViewImage/butterfly22.png"){
//        fadeInABF2(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else if(_selected == "images/gameViewImage/butterfly33.png"){
//        fadeInABF3(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else if(_selected == "images/gameViewImage/butterfly44.png"){
//        fadeInABF4(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else if(_selected == "images/gameViewImage/butterfly55.png"){
//        fadeInABF5(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else if(_selected == "images/gameViewImage/butterfly66.png"){
//        fadeInABF6(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else if(_selected == "images/gameViewImage/butterfly77.png"){
//        fadeInABF7(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else if(_selected == "images/gameViewImage/butterfly88.png"){
//        fadeInABF8(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else if(_selected == "images/gameViewImage/butterfly99.png"){
//        fadeInABF9(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else if(_selected == "images/gameViewImage/butterfly00.png"){
//        fadeInABF0(10);
//        fadeInaboutB(10);
//        fadeInaboutbb(10);
//    }else{
//    }
}

function drawEvent() {
	var canvas = document.getElementById('canvas_port');

	if (canvas.getContext) {
		var ctx = canvas.getContext('2d');
		if ((async_img_load == 0)) {
			drawCanvas(ctx);

		} else {
			drawBg(ctx);
		}
	}
}

$(document)
		.ready(
				function() {
					$('#canvas_port').mousemove(function(e) {
						var offset = $('#canvas_port').offset();

						_mover = e.clientX - offset.left;
						_mouse_on = 1;
					});

					$('#canvas_port').mouseout(function(e) {
						_mouse_on = 0;
					});

					$('#canvas_port')
							.click(
									function(e) {
										console.log("1:"+_selected);
										for ( var i = 0; i <= 9; i++) {
											if (_selected == "images/gameViewImage/butterfly"
													+ i + i + ".gif") {
												switch (i) {
												case 0:
													btfselt = 0;
													$('#filename')
															.html(
																	'<p></br>&nbsp;粉蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												case 1:
													btfselt = 1;
													$('#filename')
															.html(
																	'<p></br>&nbsp;纹白蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												case 2:
													btfselt = 2;
													$('#filename')
															.html(
																	'<p></br>&nbsp;枯叶蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												case 3:
													btfselt = 3;
													$('#filename')
															.html(
																	'<p></br>&nbsp;金线蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												case 4:
													btfselt = 4;
													$('#filename')
															.html(
																	'<p></br>&nbsp;光明女神蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												case 5:
													btfselt = 5;
													$('#filename')
															.html(
																	'<p></br>&nbsp;红点粉蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												case 6:
													btfselt = 6;
													$('#filename')
															.html(
																	'<p></br>&nbsp;黑脉金斑蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												case 7:
													btfselt = 7;
													$('#filename')
															.html(
																	'<p></br>&nbsp;蓝凤蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												case 8:
													btfselt = 8;
													$('#filename')
															.html(
																	'<p></br>&nbsp;鸟翼蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												case 9:
													btfselt = 9;
													$('#filename')
															.html(
																	'<p></br>&nbsp;鬼美人蝶</p>&nbsp;捕到的数目：' + btfnum[i]);
													break;
												}
											}
										}

										$('#fileimg')
												.html(
														'<p><div style="overflow:none; position:absolute; top:30px; left:250px;"><img src="' + _selected
																.replace('_m',
																		'') + '"/><br/></div></p>');
										e.stopPropagation();
									});

					_mover = _default_movement;

					setInterval('drawEvent()', 50);
					//getFlickrRss();
				});
</script>

							</div>
						</div>
						<img src="images/gameViewImage/t21.png"
							style="position: absolute; top: 560px; left: 0px;">
						<img src="images/gameViewImage/t22.png"
							style="position: absolute; top: 420px; left: 0px;">
						<img src="images/gameViewImage/t23.png"
							style="position: absolute; top: 420px; left: 836px;">
					</div>
				</div>
			</div>
		</div>

		<script src="js/gameViewJs/recoGFO.js">
</script>
		<script type="text/javascript" src="js/gameViewJs/drawAni1.js">
</script>

		<script src="js/publicJs/boardJS1.js">
</script>

		<script>
$(function() {
	$('a.showExp').live('click', function(evt) {
		evt.preventDefault();
		$('.fallback').fadeOut('slow', function() {
			$('.test').fadeIn('slow');
		});
	});
});
</script>


		<script>
var props = 'transform WebkitTransform MozTransform OTransform msTransform'
		.split(' '), prop, el = document.createElement('div');

for ( var i = 0, l = props.length; i < l; i++) {
	if (typeof el.style[props[i]] !== "undefined") {
		prop = props[i];
		break;
	}
}

var xAngle = 0, yAngle = 0;
$('body').keydown(function(evt) {
	switch (evt.keyCode) {
	case 37: // left
			fadeInFaceThree();
			break;

		case 39: // right
			fadeOutFaceThree();
			break;

		}
		;
		
	});</script>
		<div id="updateresult">
			0
		</div>
		<div id="loadingpage" style="position:absolute; top:0px; left:0px; width:1366px; height:730px;">
			<canvas id="colorful"></canvas>
			<img src="images/gameViewImage/circle.png" style="position:absolute; width:800px; height:800px; left:20%; top:4%;" />
			<div style="position:absolute; left:44%; top:50%;" class="container">
				<div class="content">
				<div class="circle"></div>
				<div class="circle1"></div>
			</div>
			<div style="color:#00FFFF; font-size:20px; position:absolute; width:320px; left:-40%; top:80%;">Let the time flies a while...</div>
		</div>
	</body>
</html>
